

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>datasift &mdash; DataSift Python Client Library 0.5.5 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.5.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="DataSift Python Client Library 0.5.5 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">DataSift Python Client Library 0.5.5 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for datasift</h1><div class="highlight"><pre>
<span class="c"># encoding: utf-8</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The official DataSift API library for Python. This module provides access to</span>
<span class="sd">the REST API and also facilitates consuming streams.</span>

<span class="sd">Requires Python 2.4+.</span>

<span class="sd">To use, &#39;import datasift&#39; and create a datasift.User object passing in your</span>
<span class="sd">username and API key. See the examples folder for reference usage.</span>

<span class="sd">Source Code:</span>

<span class="sd">https://github.com/datasift/datasift-python</span>

<span class="sd">Examples:</span>

<span class="sd">https://github.com/datasift/datasift-python/tree/master/examples</span>

<span class="sd">DataSift Platform Documentation:</span>

<span class="sd">http://dev.datasift.com/docs/</span>

<span class="sd">Copyright (C) 2012 MediaSift Ltd. All Rights Reserved.</span>

<span class="sd">This software is Open Source. Read the license:</span>

<span class="sd">https://github.com/datasift/datasift-python/blob/master/LICENSE</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">urllib</span><span class="o">,</span> <span class="nn">urllib2</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">thread</span><span class="o">,</span> <span class="nn">threading</span><span class="o">,</span> <span class="nn">types</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="n">__author__</span>  <span class="o">=</span> <span class="s">&quot;Stuart Dallas &lt;stuart@3ft9.com&gt;&quot;</span>
<span class="n">__status__</span>  <span class="o">=</span> <span class="s">&quot;beta&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s">&quot;0.5.5&quot;</span>
<span class="n">__date__</span>    <span class="o">=</span> <span class="s">&quot;06 March 2013&quot;</span>

<span class="c">#-----------------------------------------------------------------------------</span>
<span class="c"># Add this folder to the system path.</span>
<span class="c">#-----------------------------------------------------------------------------</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">),]</span>

<span class="c">#-----------------------------------------------------------------------------</span>
<span class="c"># Module constants</span>
<span class="c">#-----------------------------------------------------------------------------</span>
<span class="n">USER_AGENT</span>      <span class="o">=</span> <span class="s">&#39;DataSiftPython/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">__version__</span><span class="p">)</span>
<span class="n">API_BASE_URL</span>    <span class="o">=</span> <span class="s">&#39;api.datasift.com/&#39;</span>

<span class="c">#-----------------------------------------------------------------------------</span>
<span class="c"># Check for SSL support.</span>
<span class="c">#-----------------------------------------------------------------------------</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">ssl</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">SSL_AVAILABLE</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">SSL_AVAILABLE</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c">#-----------------------------------------------------------------------------</span>
<span class="c"># Module exceptions.</span>
<span class="c">#-----------------------------------------------------------------------------</span>
<div class="viewcode-block" id="AccessDeniedError"><a class="viewcode-back" href="../index.html#datasift.AccessDeniedError">[docs]</a><span class="k">class</span> <span class="nc">AccessDeniedError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This exception is thrown when an access denied error is returned by the</span>
<span class="sd">    DataSift API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="APIError"><a class="viewcode-back" href="../index.html#datasift.APIError">[docs]</a><span class="k">class</span> <span class="nc">APIError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Thrown for errors that occur while talking to the DataSift API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="CompileFailedError"><a class="viewcode-back" href="../index.html#datasift.CompileFailedError">[docs]</a><span class="k">class</span> <span class="nc">CompileFailedError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Thrown when compilation of a definition fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="InvalidDataError"><a class="viewcode-back" href="../index.html#datasift.InvalidDataError">[docs]</a><span class="k">class</span> <span class="nc">InvalidDataError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Thrown whenever invalid data is detected.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="RateLimitExceededError"><a class="viewcode-back" href="../index.html#datasift.RateLimitExceededError">[docs]</a><span class="k">class</span> <span class="nc">RateLimitExceededError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Thrown when you exceed the API rate limit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="StreamError"><a class="viewcode-back" href="../index.html#datasift.StreamError">[docs]</a><span class="k">class</span> <span class="nc">StreamError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Thrown for errors to do with the streaming API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="c">#-----------------------------------------------------------------------------</span>
<span class="c"># Module-level utility functions.</span>
<span class="c">#-----------------------------------------------------------------------------</span></div>
<span class="k">def</span> <span class="nf">_exists</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check whether the given name exists at the caller&#39;s local or global</span>
<span class="sd">    scope, or within the built-ins.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">f_locals</span>  <span class="c"># caller&#39;s locals</span>
         <span class="ow">or</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">f_globals</span> <span class="c"># caller&#39;s globals</span>
         <span class="ow">or</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="n">__builtin__</span><span class="p">)</span>          <span class="c"># built-in</span>
    <span class="p">)</span>

<span class="c">#-----------------------------------------------------------------------------</span>
<span class="c"># The User class - all interactions with the API should start here.</span>
<span class="c">#-----------------------------------------------------------------------------</span>
<div class="viewcode-block" id="User"><a class="viewcode-back" href="../index.html#datasift.User">[docs]</a><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A User instance represents a DataSift user and provides access to all of</span>
<span class="sd">    the API functionality.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_username</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">_api_key</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">_rate_limit</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">_rate_limit_remaining</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">_api_client</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_use_ssl</span> <span class="o">=</span> <span class="n">SSL_AVAILABLE</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">use_ssl</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">stream_base_url</span> <span class="o">=</span> <span class="s">&#39;stream.datasift.com/&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise a User object with the given username and API key.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_api_key</span> <span class="o">=</span> <span class="n">api_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_ssl</span> <span class="o">=</span> <span class="n">use_ssl</span>
        <span class="k">if</span> <span class="n">stream_base_url</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;/&#39;</span><span class="p">:</span>
            <span class="n">stream_base_url</span> <span class="o">+=</span> <span class="s">&#39;/&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream_base_url</span> <span class="o">=</span> <span class="n">stream_base_url</span>

<div class="viewcode-block" id="User.get_username"><a class="viewcode-back" href="../index.html#datasift.User.get_username">[docs]</a>    <span class="k">def</span> <span class="nf">get_username</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the username.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_username</span>
</div>
<div class="viewcode-block" id="User.get_api_key"><a class="viewcode-back" href="../index.html#datasift.User.get_api_key">[docs]</a>    <span class="k">def</span> <span class="nf">get_api_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the API key.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_key</span>
</div>
<div class="viewcode-block" id="User.use_ssl"><a class="viewcode-back" href="../index.html#datasift.User.use_ssl">[docs]</a>    <span class="k">def</span> <span class="nf">use_ssl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns true if stream connections should be using SSL.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">SSL_AVAILABLE</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_ssl</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="User.enable_ssl"><a class="viewcode-back" href="../index.html#datasift.User.enable_ssl">[docs]</a>    <span class="k">def</span> <span class="nf">enable_ssl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_ssl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set whether stream connections should use SSL.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_ssl</span> <span class="o">=</span> <span class="n">use_ssl</span>
</div>
<div class="viewcode-block" id="User.get_rate_limit"><a class="viewcode-back" href="../index.html#datasift.User.get_rate_limit">[docs]</a>    <span class="k">def</span> <span class="nf">get_rate_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the rate limit returned by the last API call, or -1 if no API calls</span>
<span class="sd">        have been made since this object was created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rate_limit</span>
</div>
<div class="viewcode-block" id="User.get_rate_limit_remaining"><a class="viewcode-back" href="../index.html#datasift.User.get_rate_limit_remaining">[docs]</a>    <span class="k">def</span> <span class="nf">get_rate_limit_remaining</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the rate limit remaining as returned by the last API call, or -1 if</span>
<span class="sd">        no API calls have been made since this object was created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rate_limit_remaining</span>
</div>
<div class="viewcode-block" id="User.set_api_client"><a class="viewcode-back" href="../index.html#datasift.User.set_api_client">[docs]</a>    <span class="k">def</span> <span class="nf">set_api_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_client</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the object to be used as the API client. This must be a subclass</span>
<span class="sd">        of the default API client class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_api_client</span> <span class="o">=</span> <span class="n">api_client</span>
</div>
<div class="viewcode-block" id="User.get_usage"><a class="viewcode-back" href="../index.html#datasift.User.get_usage">[docs]</a>    <span class="k">def</span> <span class="nf">get_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="s">&#39;hour&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get usage data for this user.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span><span class="s">&#39;usage&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="s">&#39;period&#39;</span><span class="p">:</span> <span class="n">period</span> <span class="p">})</span>
</div>
<div class="viewcode-block" id="User.create_definition"><a class="viewcode-back" href="../index.html#datasift.User.create_definition">[docs]</a>    <span class="k">def</span> <span class="nf">create_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csdl</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a definition object for this user. If a CSDL parameter is</span>
<span class="sd">        provided then this will be used as the initial CSDL for the</span>
<span class="sd">        definition.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Definition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csdl</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="User.create_historic"><a class="viewcode-back" href="../index.html#datasift.User.create_historic">[docs]</a>    <span class="k">def</span> <span class="nf">create_historic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">hash</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a historic query based on this definition.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Historic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">hash</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="User.get_historic"><a class="viewcode-back" href="../index.html#datasift.User.get_historic">[docs]</a>    <span class="k">def</span> <span class="nf">get_historic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">playback_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an existing Historics query from the API.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Historic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">playback_id</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="User.list_historics"><a class="viewcode-back" href="../index.html#datasift.User.list_historics">[docs]</a>    <span class="k">def</span> <span class="nf">list_historics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">per_page</span> <span class="o">=</span> <span class="mi">20</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the Historics queries in your account.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Historic</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">per_page</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="User.create_push_definition"><a class="viewcode-back" href="../index.html#datasift.User.create_push_definition">[docs]</a>    <span class="k">def</span> <span class="nf">create_push_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new Push definition for this user.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PushDefinition</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="User.get_push_subscription"><a class="viewcode-back" href="../index.html#datasift.User.get_push_subscription">[docs]</a>    <span class="k">def</span> <span class="nf">get_push_subscription</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subscription_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a Push subscription from the API.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PushSubscription</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subscription_id</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="User.get_push_subscription_log"><a class="viewcode-back" href="../index.html#datasift.User.get_push_subscription_log">[docs]</a>    <span class="k">def</span> <span class="nf">get_push_subscription_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subscription_id</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the logs for all Push subscriptions or the given subscription.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">subscription_id</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PushSubscription</span><span class="o">.</span><span class="n">get_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_push_subscription</span><span class="p">(</span><span class="n">subscription_id</span><span class="p">)</span><span class="o">.</span><span class="n">get_log</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="User.list_push_subscriptions"><a class="viewcode-back" href="../index.html#datasift.User.list_push_subscriptions">[docs]</a>    <span class="k">def</span> <span class="nf">list_push_subscriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">per_page</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">order_by</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">order_dir</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">include_finished</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">hash_type</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="nb">hash</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the Push subscriptions in your account.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PushSubscription</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">per_page</span><span class="p">,</span> <span class="n">order_by</span><span class="p">,</span> <span class="n">order_dir</span><span class="p">,</span> <span class="n">include_finished</span><span class="p">,</span> <span class="n">hash_type</span><span class="p">,</span> <span class="nb">hash</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="User.get_consumer"><a class="viewcode-back" href="../index.html#datasift.User.get_consumer">[docs]</a>    <span class="k">def</span> <span class="nf">get_consumer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">hash</span><span class="p">,</span> <span class="n">event_handler</span><span class="p">,</span> <span class="n">consumer_type</span> <span class="o">=</span> <span class="s">&#39;http&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a StreamConsumer object for the given hash via the given consumer</span>
<span class="sd">        type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">StreamConsumer</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">consumer_type</span><span class="p">,</span> <span class="n">Definition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="nb">hash</span><span class="p">),</span> <span class="n">event_handler</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="User.get_multi_consumer"><a class="viewcode-back" href="../index.html#datasift.User.get_multi_consumer">[docs]</a>    <span class="k">def</span> <span class="nf">get_multi_consumer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hashes</span><span class="p">,</span> <span class="n">event_handler</span><span class="p">,</span> <span class="n">consumer_type</span> <span class="o">=</span> <span class="s">&#39;http&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a StreamConsumer object for the given set of hashes via the given</span>
<span class="sd">        consumer type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">StreamConsumer</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">consumer_type</span><span class="p">,</span> <span class="n">hashes</span><span class="p">,</span> <span class="n">event_handler</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="User.get_useragent"><a class="viewcode-back" href="../index.html#datasift.User.get_useragent">[docs]</a>    <span class="k">def</span> <span class="nf">get_useragent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the useragent to be used for all API requests.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">USER_AGENT</span>
</div>
<div class="viewcode-block" id="User.call_api"><a class="viewcode-back" href="../index.html#datasift.User.call_api">[docs]</a>    <span class="k">def</span> <span class="nf">call_api</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a call to a DataSift API endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_client</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_api_client</span> <span class="o">=</span> <span class="n">ApiClient</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_client</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_username</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_api_key</span><span class="p">(),</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_useragent</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rate_limit</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;rate_limit&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rate_limit_remaining</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;rate_limit_remaining&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;response_code&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="ow">and</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;response_code&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">299</span><span class="p">:</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;response_code&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
            <span class="n">errmsg</span> <span class="o">=</span> <span class="s">&#39;Authentication failed&#39;</span>
            <span class="k">if</span> <span class="s">&#39;data&#39;</span> <span class="ow">in</span> <span class="n">res</span> <span class="ow">and</span> <span class="s">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">]:</span>
                <span class="n">errmsg</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;error&#39;</span><span class="p">]</span>
            <span class="k">raise</span> <span class="n">AccessDeniedError</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;response_code&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">403</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rate_limit_remaining</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">RateLimitExceededError</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;comment&#39;</span><span class="p">])</span>
            <span class="n">errmsg</span> <span class="o">=</span> <span class="s">&#39;Unknown error (</span><span class="si">%d</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;response_code&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s">&#39;data&#39;</span> <span class="ow">in</span> <span class="n">res</span> <span class="ow">and</span> <span class="s">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">]:</span>
                <span class="n">errmsg</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;error&#39;</span><span class="p">]</span>
            <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="n">errmsg</span><span class="p">,</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;response_code&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">retval</span>

<span class="c">#-----------------------------------------------------------------------------</span>
<span class="c"># The Definition class.</span>
<span class="c">#-----------------------------------------------------------------------------</span></div></div>
<div class="viewcode-block" id="Definition"><a class="viewcode-back" href="../index.html#datasift.Definition">[docs]</a><span class="k">class</span> <span class="nc">Definition</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Definition instance represents a stream definition.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_user</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">_hash</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">_created_at</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">_total_dpu</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">_csdl</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">csdl</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="nb">hash</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise a Definition object, optionally priming it with the given CSDL and/or</span>
<span class="sd">        hash.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">User</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Please supply a valid User object when creating a Definition object.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="n">user</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span> <span class="o">=</span> <span class="nb">hash</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">csdl</span><span class="p">)</span>

<div class="viewcode-block" id="Definition.get"><a class="viewcode-back" href="../index.html#datasift.Definition.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the definition&#39;s CSDL string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdl</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;CSDL not available&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdl</span>
</div>
<div class="viewcode-block" id="Definition.set"><a class="viewcode-back" href="../index.html#datasift.Definition.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csdl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the definition string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">csdl</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_csdl</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">csdl</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
                <span class="n">csdl</span> <span class="o">=</span> <span class="n">csdl</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf8&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">csdl</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Definitions must be strings.&#39;</span><span class="p">)</span>

            <span class="n">csdl</span> <span class="o">=</span> <span class="n">csdl</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="c"># Reset the hash if the CSDL hash changed</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdl</span> <span class="o">!=</span> <span class="n">csdl</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clear_hash</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_csdl</span> <span class="o">=</span> <span class="n">csdl</span>
</div>
<div class="viewcode-block" id="Definition.get_hash"><a class="viewcode-back" href="../index.html#datasift.Definition.get_hash">[docs]</a>    <span class="k">def</span> <span class="nf">get_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the hash for this definition. If the hash has not yet been</span>
<span class="sd">        obtained it compiles the definition first.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span>
</div>
<div class="viewcode-block" id="Definition.clear_hash"><a class="viewcode-back" href="../index.html#datasift.Definition.clear_hash">[docs]</a>    <span class="k">def</span> <span class="nf">clear_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset the hash to false. The effect of this is to mark the definition</span>
<span class="sd">        as requiring compilation. Also resets other variables that depend on</span>
<span class="sd">        the CSDL.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdl</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Cannot clear the hash of a hash-only definition object&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_created_at</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_total_dpu</span> <span class="o">=</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="Definition.get_created_at"><a class="viewcode-back" href="../index.html#datasift.Definition.get_created_at">[docs]</a>    <span class="k">def</span> <span class="nf">get_created_at</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the date when the stream was first created. If the created at</span>
<span class="sd">        date has not yet been obtained it validates the definition first.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdl</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Created at date not available&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_created_at</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">InvalidDataError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_created_at</span>
</div>
<div class="viewcode-block" id="Definition.get_total_dpu"><a class="viewcode-back" href="../index.html#datasift.Definition.get_total_dpu">[docs]</a>    <span class="k">def</span> <span class="nf">get_total_dpu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the total DPU of the stream. If the DPU has not yet been</span>
<span class="sd">        obtained it validates the definition first.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdl</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Total DPU not available&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total_dpu</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">InvalidDataError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total_dpu</span>
</div>
<div class="viewcode-block" id="Definition.compile"><a class="viewcode-back" href="../index.html#datasift.Definition.compile">[docs]</a>    <span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the DataSift API to compile this definition. If compilation</span>
<span class="sd">        succeeds we store the details in the response.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_csdl</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Cannot compile an empty definition&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span><span class="s">&#39;compile&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="s">&#39;csdl&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdl</span> <span class="p">})</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;hash&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CompileFailedError</span><span class="p">(</span><span class="s">&#39;Compiled successfully but no hash in the response&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;hash&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;created_at&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CompileFailedError</span><span class="p">(</span><span class="s">&#39;Compiled successfully but no created_at in the response&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_created_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&#39;created_at&#39;</span><span class="p">],</span> <span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;dpu&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CompileFailedError</span><span class="p">(</span><span class="s">&#39;Compiled successfully but no DPU in the response&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_total_dpu</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;dpu&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">APIError</span> <span class="k">as</span> <span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_hash</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">400</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CompileFailedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CompileFailedError</span><span class="p">(</span><span class="s">&#39;Unexpected APIError code: </span><span class="si">%d</span><span class="s"> [</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Definition.validate"><a class="viewcode-back" href="../index.html#datasift.Definition.validate">[docs]</a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the DataSift API to validate this definition. If validation</span>
<span class="sd">        succeeds we store the details in the response.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_csdl</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Cannot validate an empty definition&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span><span class="s">&#39;validate&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="s">&#39;csdl&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csdl</span> <span class="p">})</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;created_at&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CompileFailedError</span><span class="p">(</span><span class="s">&#39;Validated successfully but no created_at in the response&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_created_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&#39;created_at&#39;</span><span class="p">],</span> <span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;dpu&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CompileFailedError</span><span class="p">(</span><span class="s">&#39;Validated successfully but no DPU in the response&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_total_dpu</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;dpu&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">APIError</span> <span class="k">as</span> <span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_hash</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">400</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CompileFailedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CompileFailedError</span><span class="p">(</span><span class="s">&#39;Unexpected APIError code: </span><span class="si">%d</span><span class="s"> [</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Definition.get_dpu_breakdown"><a class="viewcode-back" href="../index.html#datasift.Definition.get_dpu_breakdown">[docs]</a>    <span class="k">def</span> <span class="nf">get_dpu_breakdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the DataSift API to get the DPU breakdown for this definition.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_csdl</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Cannot get the DPU breakdown for an empty definition&#39;</span><span class="p">)</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span><span class="s">&#39;dpu&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="s">&#39;hash&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_hash</span><span class="p">()</span> <span class="p">})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;dpu&#39;</span> <span class="ow">in</span> <span class="n">retval</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="s">&#39;No total DPU value present in the breakdown data&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_total_dpu</span> <span class="o">=</span> <span class="n">retval</span><span class="p">[</span><span class="s">&#39;dpu&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">retval</span>
</div>
<div class="viewcode-block" id="Definition.get_buffered"><a class="viewcode-back" href="../index.html#datasift.Definition.get_buffered">[docs]</a>    <span class="k">def</span> <span class="nf">get_buffered</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">from_id</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the DataSift API to get buffered interactions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_csdl</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Cannot get buffered interactions for an empty definition&#39;</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;hash&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_hash</span><span class="p">()</span> <span class="p">}</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">!=</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>
        <span class="k">if</span> <span class="n">from_id</span> <span class="o">!=</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&#39;interaction_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">from_id</span>

        <span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span><span class="s">&#39;stream&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;stream&#39;</span> <span class="ow">in</span> <span class="n">retval</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="s">&#39;No data in the response&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">retval</span><span class="p">[</span><span class="s">&#39;stream&#39;</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Definition.create_historic"><a class="viewcode-back" href="../index.html#datasift.Definition.create_historic">[docs]</a>    <span class="k">def</span> <span class="nf">create_historic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a historic query based on this definition.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Historic</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_hash</span><span class="p">(),</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Definition.get_consumer"><a class="viewcode-back" href="../index.html#datasift.Definition.get_consumer">[docs]</a>    <span class="k">def</span> <span class="nf">get_consumer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_handler</span><span class="p">,</span> <span class="n">consumer_type</span> <span class="o">=</span> <span class="s">&#39;http&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a StreamConsumer-derived object for this definition for the</span>
<span class="sd">        given type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event_handler</span><span class="p">,</span> <span class="n">StreamConsumerEventHandler</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Please supply an object derived from StreamConsumerEventHandler when requesting a consumer&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">StreamConsumer</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="p">,</span> <span class="n">consumer_type</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">event_handler</span><span class="p">)</span>

<span class="c">#-----------------------------------------------------------------------------</span>
<span class="c"># The Historic class.</span>
<span class="c">#-----------------------------------------------------------------------------</span></div></div>
<div class="viewcode-block" id="Historic"><a class="viewcode-back" href="../index.html#datasift.Historic">[docs]</a><span class="k">class</span> <span class="nc">Historic</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Historic instance represents a historic query.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_user</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_playback_id</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">_dpus</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">_availability</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">_hash</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">_start</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">_end</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">_created_at</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">_sample</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">_sources</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">_status</span> <span class="o">=</span> <span class="s">&#39;created&#39;</span>
    <span class="n">_progress</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_deleted</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Historic.list"><a class="viewcode-back" href="../index.html#datasift.Historic.list">[docs]</a>    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">per_page</span> <span class="o">=</span> <span class="mi">20</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a page of Historics queries in the given user&#39;s account, where</span>
<span class="sd">        each page contains up to per_page items.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">page</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;The specified page number is invalid&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">per_page</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;The specified per_page value is invalid&#39;</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;page&#39;</span><span class="p">:</span> <span class="n">page</span><span class="p">,</span>
            <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="n">per_page</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span><span class="s">&#39;historics/get&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

        <span class="n">retval</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;count&#39;</span><span class="p">:</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;count&#39;</span><span class="p">],</span>
            <span class="s">&#39;historics&#39;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">historic</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">]:</span>
            <span class="n">retval</span><span class="p">[</span><span class="s">&#39;historics&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Historic</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">historic</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">retval</span>
</div>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="nb">hash</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">sources</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">sample</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct a new Historic query object from the supplied data. If the</span>
<span class="sd">        hash is a dict the object will be populated from that. If start is not</span>
<span class="sd">        supplied we&#39;ll attempt to load the object from the API using that as</span>
<span class="sd">        the playback ID. Otherwise a new Historics query is created using the</span>
<span class="sd">        data passed in.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">User</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Please supply a valid User object when creating a Historic object.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="n">user</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">hash</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c"># Initialising from a dict</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">(</span><span class="nb">hash</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">start</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># The hash is the playback ID, get it from the API</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_playback_id</span> <span class="o">=</span> <span class="nb">hash</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reload_data</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Creating a new Historics query</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">hash</span><span class="p">,</span> <span class="n">Definition</span><span class="p">):</span>
                <span class="nb">hash</span> <span class="o">=</span> <span class="nb">hash</span><span class="o">.</span><span class="n">get_hash</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Please supply a valid start timestamp&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">end</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Please supply a valid end timestamp&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sources</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">sources</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Please supply a valid array of sources&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span>       <span class="o">=</span> <span class="nb">hash</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start</span>      <span class="o">=</span> <span class="n">start</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_end</span>        <span class="o">=</span> <span class="n">end</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sources</span>    <span class="o">=</span> <span class="n">sources</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sample</span>     <span class="o">=</span> <span class="n">sample</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>       <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_created_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populate this object from the data in a dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;The playback ID is missing&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_playback_id</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;definition_id&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;The stream hash is missing&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;definition_id&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;The name is missing&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;start&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;The start timestamp is missing&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;end&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;The end timestamp is missing&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;status&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;The status is missing&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;progress&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;The progress is missing&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;progress&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;created_at&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;The created at timestamp is missing&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_created_at</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;created_at&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;sources&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;The sources is missing&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sources</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;sources&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;sample&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;The sample is missing&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sample</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;sample&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_deleted</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">==</span> <span class="s">&#39;deleted&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Historic.get_start_date"><a class="viewcode-back" href="../index.html#datasift.Historic.get_start_date">[docs]</a>    <span class="k">def</span> <span class="nf">get_start_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the start date for this query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span>
</div>
<div class="viewcode-block" id="Historic.get_end_date"><a class="viewcode-back" href="../index.html#datasift.Historic.get_end_date">[docs]</a>    <span class="k">def</span> <span class="nf">get_end_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the end date for this query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span>
</div>
<div class="viewcode-block" id="Historic.get_created_at"><a class="viewcode-back" href="../index.html#datasift.Historic.get_created_at">[docs]</a>    <span class="k">def</span> <span class="nf">get_created_at</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the created_at date for this query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_created_at</span>
</div>
<div class="viewcode-block" id="Historic.get_name"><a class="viewcode-back" href="../index.html#datasift.Historic.get_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the friendly name of this query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
</div>
<div class="viewcode-block" id="Historic.get_sources"><a class="viewcode-back" href="../index.html#datasift.Historic.get_sources">[docs]</a>    <span class="k">def</span> <span class="nf">get_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the sources for this query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sources</span>
</div>
<div class="viewcode-block" id="Historic.get_progress"><a class="viewcode-back" href="../index.html#datasift.Historic.get_progress">[docs]</a>    <span class="k">def</span> <span class="nf">get_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the progress percentage of this query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span>
</div>
<div class="viewcode-block" id="Historic.get_sample"><a class="viewcode-back" href="../index.html#datasift.Historic.get_sample">[docs]</a>    <span class="k">def</span> <span class="nf">get_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the sample percentage of this query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample</span>
</div>
<div class="viewcode-block" id="Historic.get_status"><a class="viewcode-back" href="../index.html#datasift.Historic.get_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the status of this query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span>
</div>
<div class="viewcode-block" id="Historic.set_name"><a class="viewcode-back" href="../index.html#datasift.Historic.set_name">[docs]</a>    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the friendly name for this query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deleted</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Cannot set the name of a deleted Historics query&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_playback_id</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="c"># Not prepared yet, just set it locally</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Already sent to the API, update the name via that API</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span>
                    <span class="s">&#39;historics/update&#39;</span><span class="p">,</span>
                    <span class="p">{</span>
                        <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_playback_id</span><span class="p">,</span>
                        <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
                    <span class="p">})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reload_data</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">APIError</span> <span class="k">as</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">400</span><span class="p">:</span>
                    <span class="c"># Missing or invalid parameters</span>
                    <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="s">&#39;Unexpected APIError code: </span><span class="si">%d</span><span class="s"> [</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Historic.get_hash"><a class="viewcode-back" href="../index.html#datasift.Historic.get_hash">[docs]</a>    <span class="k">def</span> <span class="nf">get_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the playback ID for this query. If the query has not yet been</span>
<span class="sd">        prepared this will be done automagically to get the hash.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_playback_id</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prepare</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_playback_id</span>
</div>
<div class="viewcode-block" id="Historic.get_stream_hash"><a class="viewcode-back" href="../index.html#datasift.Historic.get_stream_hash">[docs]</a>    <span class="k">def</span> <span class="nf">get_stream_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the hash for the stream this Historics query is using.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span>
</div>
<div class="viewcode-block" id="Historic.get_dpus"><a class="viewcode-back" href="../index.html#datasift.Historic.get_dpus">[docs]</a>    <span class="k">def</span> <span class="nf">get_dpus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the DPU cost. If the query has not yet been prepared this will be</span>
<span class="sd">        done automagically to obtain the cost.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dpus</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prepare</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dpus</span>
</div>
<div class="viewcode-block" id="Historic.get_availability"><a class="viewcode-back" href="../index.html#datasift.Historic.get_availability">[docs]</a>    <span class="k">def</span> <span class="nf">get_availability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the data availability info. If the query has not yet been prepared</span>
<span class="sd">        this will be done automagically to obtain the availability data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_availability</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prepare</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_availability</span>
</div>
    <span class="k">def</span> <span class="nf">reload_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deleted</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Cannot set the name of a deleted Historics query&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_playback_id</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Cannot reload the data for a Historics query that hasn</span><span class="se">\&#39;</span><span class="s">t been prepared&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span>
                <span class="s">&#39;historics/get&#39;</span><span class="p">,</span>
                <span class="p">{</span>
                    <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_playback_id</span>
                <span class="p">}))</span>

        <span class="k">except</span> <span class="n">APIError</span> <span class="k">as</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">400</span><span class="p">:</span>
                <span class="c"># Missing or invalid parameters</span>
                <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="s">&#39;Unexpected APIError code: </span><span class="si">%d</span><span class="s"> [</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

<div class="viewcode-block" id="Historic.prepare"><a class="viewcode-back" href="../index.html#datasift.Historic.prepare">[docs]</a>    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the DataSift API to prepare this historic query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deleted</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Cannot prepare a deleted Historics query&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_playback_id</span> <span class="o">!=</span> <span class="bp">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;This historic query has already been prepared&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span>
                <span class="s">&#39;historics/prepare&#39;</span><span class="p">,</span>
                <span class="p">{</span>
                    <span class="s">&#39;hash&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span><span class="p">,</span>
                    <span class="s">&#39;start&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">,</span>
                    <span class="s">&#39;end&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">,</span>
                    <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span>
                    <span class="s">&#39;sources&#39;</span><span class="p">:</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sources</span><span class="p">),</span>
                    <span class="s">&#39;sample&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample</span>
                <span class="p">})</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="s">&#39;Prepared successfully but no playback ID in the response&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_playback_id</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;dpus&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="s">&#39;Prepared successfully but no DPU cost in the response&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dpus</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;dpus&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;availability&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="s">&#39;Prepared successfully but no availability in the response&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_availability</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;availability&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">APIError</span> <span class="k">as</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">400</span><span class="p">:</span>
                <span class="c"># Missing or invalid parameters</span>
                <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="s">&#39;Unexpected APIError code: </span><span class="si">%d</span><span class="s"> [</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Historic.start"><a class="viewcode-back" href="../index.html#datasift.Historic.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start this historic query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deleted</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Cannot start a deleted Historics query&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_playback_id</span> <span class="o">==</span> <span class="bp">False</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_playback_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Cannot start a historic query that hasn</span><span class="se">\&#39;</span><span class="s">t been prepared&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span>
                    <span class="s">&#39;historics/start&#39;</span><span class="p">,</span>
                    <span class="p">{</span>
                        <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_playback_id</span>
                    <span class="p">})</span>
        <span class="k">except</span> <span class="n">APIError</span> <span class="k">as</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">400</span><span class="p">:</span>
                <span class="c"># Missing or invalid parameters</span>
                <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
                <span class="c"># Historic query not found</span>
                <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="s">&#39;Unexpected APIError code: </span><span class="si">%d</span><span class="s"> [</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Historic.stop"><a class="viewcode-back" href="../index.html#datasift.Historic.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop this historic query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deleted</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Cannot stop a deleted Historics query&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_playback_id</span> <span class="o">==</span> <span class="bp">False</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_playback_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Cannot stop a historic query that hasn</span><span class="se">\&#39;</span><span class="s">t been prepared&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span>
                    <span class="s">&#39;historics/stop&#39;</span><span class="p">,</span>
                    <span class="p">{</span>
                        <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_playback_id</span>
                    <span class="p">})</span>
        <span class="k">except</span> <span class="n">APIError</span> <span class="k">as</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">400</span><span class="p">:</span>
                <span class="c"># Missing or invalid parameters</span>
                <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
                <span class="c"># Historic query not found</span>
                <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="s">&#39;Unexpected APIError code: </span><span class="si">%d</span><span class="s"> [</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Historic.delete"><a class="viewcode-back" href="../index.html#datasift.Historic.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete this historic query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deleted</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;This Historics query has already been deleted&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_playback_id</span> <span class="o">==</span> <span class="bp">False</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_playback_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Cannot delete a historic query that hasn</span><span class="se">\&#39;</span><span class="s">t been prepared&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span>
                    <span class="s">&#39;historics/delete&#39;</span><span class="p">,</span>
                    <span class="p">{</span>
                        <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_playback_id</span>
                    <span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_deleted</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">except</span> <span class="n">APIError</span> <span class="k">as</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">400</span><span class="p">:</span>
                <span class="c"># Missing or invalid parameters</span>
                <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
                <span class="c"># Historic query not found</span>
                <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="s">&#39;Unexpected APIError code: </span><span class="si">%d</span><span class="s"> [</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

<span class="c">#-----------------------------------------------------------------------------</span>
<span class="c"># The PushDefinition class.</span>
<span class="c">#-----------------------------------------------------------------------------</span></div></div>
<div class="viewcode-block" id="PushDefinition"><a class="viewcode-back" href="../index.html#datasift.PushDefinition">[docs]</a><span class="k">class</span> <span class="nc">PushDefinition</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A PushDefinition instance represents a push endpoint configuration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">OUTPUT_PARAMS_PREFIX</span> <span class="o">=</span> <span class="s">&#39;output_params.&#39;</span>
    <span class="n">_user</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">_initial_status</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">_output_type</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">_output_params</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise a PushDefinition object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">User</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Please supply a valid User object when creating a PushDefinition object.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="n">user</span>

<div class="viewcode-block" id="PushDefinition.get_initial_status"><a class="viewcode-back" href="../index.html#datasift.PushDefinition.get_initial_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_initial_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the initial status for subscriptions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initial_status</span>
</div>
<div class="viewcode-block" id="PushDefinition.set_initial_status"><a class="viewcode-back" href="../index.html#datasift.PushDefinition.set_initial_status">[docs]</a>    <span class="k">def</span> <span class="nf">set_initial_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the initial status for subscriptions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initial_status</span> <span class="o">=</span> <span class="n">status</span>
</div>
<div class="viewcode-block" id="PushDefinition.get_output_type"><a class="viewcode-back" href="../index.html#datasift.PushDefinition.get_output_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_output_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the output type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_type</span>
</div>
<div class="viewcode-block" id="PushDefinition.set_output_type"><a class="viewcode-back" href="../index.html#datasift.PushDefinition.set_output_type">[docs]</a>    <span class="k">def</span> <span class="nf">set_output_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the output type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_type</span> <span class="o">=</span> <span class="n">output_type</span>
</div>
<div class="viewcode-block" id="PushDefinition.get_output_param"><a class="viewcode-back" href="../index.html#datasift.PushDefinition.get_output_param">[docs]</a>    <span class="k">def</span> <span class="nf">get_output_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an output parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_params</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT_PARAMS_PREFIX</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="PushDefinition.get_output_params"><a class="viewcode-back" href="../index.html#datasift.PushDefinition.get_output_params">[docs]</a>    <span class="k">def</span> <span class="nf">get_output_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all of the output parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_params</span>
</div>
<div class="viewcode-block" id="PushDefinition.set_output_param"><a class="viewcode-back" href="../index.html#datasift.PushDefinition.set_output_param">[docs]</a>    <span class="k">def</span> <span class="nf">set_output_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set an output parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_params</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT_PARAMS_PREFIX</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
</div>
<div class="viewcode-block" id="PushDefinition.validate"><a class="viewcode-back" href="../index.html#datasift.PushDefinition.validate">[docs]</a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the output type and parameters with the DataSift API.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;output_type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output_type</span><span class="p">()</span> <span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_params</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span><span class="s">&#39;push/validate&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PushDefinition.subscribe_definition"><a class="viewcode-back" href="../index.html#datasift.PushDefinition.subscribe_definition">[docs]</a>    <span class="k">def</span> <span class="nf">subscribe_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">definition</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subscribe this endpoint to a Definition.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscribe_stream_hash</span><span class="p">(</span><span class="n">definition</span><span class="o">.</span><span class="n">get_hash</span><span class="p">(),</span> <span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PushDefinition.subscribe_stream_hash"><a class="viewcode-back" href="../index.html#datasift.PushDefinition.subscribe_stream_hash">[docs]</a>    <span class="k">def</span> <span class="nf">subscribe_stream_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">hash</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subscribe this endpoint to a stream hash.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&#39;hash&#39;</span><span class="p">,</span> <span class="nb">hash</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PushDefinition.subscribe_historic"><a class="viewcode-back" href="../index.html#datasift.PushDefinition.subscribe_historic">[docs]</a>    <span class="k">def</span> <span class="nf">subscribe_historic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">historic</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subscribe this endpoint to a Historic.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscribe_historic_playback_id</span><span class="p">(</span><span class="n">historic</span><span class="o">.</span><span class="n">get_hash</span><span class="p">(),</span> <span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PushDefinition.subscribe_historic_playback_id"><a class="viewcode-back" href="../index.html#datasift.PushDefinition.subscribe_historic_playback_id">[docs]</a>    <span class="k">def</span> <span class="nf">subscribe_historic_playback_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">playback_id</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subscribe this endpoint to a historic playback ID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&#39;playback_id&#39;</span><span class="p">,</span> <span class="n">playback_id</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PushDefinition.subscribe"><a class="viewcode-back" href="../index.html#datasift.PushDefinition.subscribe">[docs]</a>    <span class="k">def</span> <span class="nf">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hash_type</span><span class="p">,</span> <span class="nb">hash</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subscribe this endpoint to a stream hash or historic playback ID. Note</span>
<span class="sd">        that this will activate the subscription if the initial status is set</span>
<span class="sd">        to active.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="n">hash_type</span><span class="p">:</span> <span class="nb">hash</span><span class="p">,</span>
            <span class="s">&#39;output_type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output_type</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_params</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_initial_status</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&#39;initial_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_initial_status</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">PushSubscription</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span><span class="s">&#39;push/create&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>

<span class="c">#-----------------------------------------------------------------------------</span>
<span class="c"># The PushSubscription class.</span>
<span class="c">#-----------------------------------------------------------------------------</span></div></div>
<div class="viewcode-block" id="PushSubscription"><a class="viewcode-back" href="../index.html#datasift.PushSubscription">[docs]</a><span class="k">class</span> <span class="nc">PushSubscription</span><span class="p">(</span><span class="n">PushDefinition</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A PushSubscription instance represents the subscription of a push endpoint</span>
<span class="sd">    either a stream hash or a historic playback ID.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">HASH_TYPE_STREAM</span>   <span class="o">=</span> <span class="s">&#39;stream&#39;</span><span class="p">;</span>
    <span class="n">HASH_TYPE_HISTORIC</span> <span class="o">=</span> <span class="s">&#39;historic&#39;</span><span class="p">;</span>

    <span class="n">STATUS_ACTIVE</span>    <span class="o">=</span> <span class="s">&#39;active&#39;</span><span class="p">;</span>
    <span class="n">STATUS_PAUSED</span>    <span class="o">=</span> <span class="s">&#39;paused&#39;</span><span class="p">;</span>
    <span class="n">STATUS_STOPPED</span>   <span class="o">=</span> <span class="s">&#39;stopped&#39;</span><span class="p">;</span>
    <span class="n">STATUS_FINISHING</span> <span class="o">=</span> <span class="s">&#39;finishing&#39;</span><span class="p">;</span>
    <span class="n">STATUS_FINISHED</span>  <span class="o">=</span> <span class="s">&#39;finished&#39;</span><span class="p">;</span>
    <span class="n">STATUS_FAILED</span>    <span class="o">=</span> <span class="s">&#39;finished&#39;</span><span class="p">;</span>
    <span class="n">STATUS_DELETED</span>   <span class="o">=</span> <span class="s">&#39;deleted&#39;</span><span class="p">;</span>

    <span class="n">ORDERBY_ID</span>           <span class="o">=</span> <span class="s">&#39;id&#39;</span><span class="p">;</span>
    <span class="n">ORDERBY_CREATED_AT</span>   <span class="o">=</span> <span class="s">&#39;created_at&#39;</span><span class="p">;</span>
    <span class="n">ORDERBY_REQUEST_TIME</span> <span class="o">=</span> <span class="s">&#39;request_time&#39;</span><span class="p">;</span>

    <span class="n">ORDERDIR_ASC</span>  <span class="o">=</span> <span class="s">&#39;asc&#39;</span><span class="p">;</span>
    <span class="n">ORDERDIR_DESC</span> <span class="o">=</span> <span class="s">&#39;desc&#39;</span><span class="p">;</span>

    <span class="n">_user</span>         <span class="o">=</span> <span class="bp">False</span>
    <span class="n">_id</span>           <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">_created_at</span>   <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">_name</span>         <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">_status</span>       <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">_hash</span>         <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">_hash_type</span>    <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">_last_request</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_last_success</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="PushSubscription.get"><a class="viewcode-back" href="../index.html#datasift.PushSubscription.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a push subscription by ID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PushSubscription</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span><span class="s">&#39;push/get&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="nb">id</span> <span class="p">}))</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="PushSubscription.list"><a class="viewcode-back" href="../index.html#datasift.PushSubscription.list">[docs]</a>    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">per_page</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">order_by</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">order_dir</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">include_finished</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">hash_type</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="nb">hash</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a page of push subscriptions in the given user&#39;s account, where</span>
<span class="sd">        each page contains up to per_page items. Results will be ordered</span>
<span class="sd">        according to the supplied ordering parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">page</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;The specified page number is invalid&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">per_page</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;The specified per_page value is invalid&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">order_by</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">order_by</span> <span class="o">=</span> <span class="n">PushSubscription</span><span class="o">.</span><span class="n">ORDERBY_CREATED_AT</span>
        <span class="k">if</span> <span class="n">order_dir</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">order_dir</span> <span class="o">=</span> <span class="n">PushSubscription</span><span class="o">.</span><span class="n">ORDERDIR_ASC</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;page&#39;</span><span class="p">:</span> <span class="n">page</span><span class="p">,</span>
            <span class="s">&#39;per_page&#39;</span><span class="p">:</span> <span class="n">per_page</span><span class="p">,</span>
            <span class="s">&#39;order_by&#39;</span><span class="p">:</span> <span class="n">order_by</span><span class="p">,</span>
            <span class="s">&#39;order_dir&#39;</span><span class="p">:</span> <span class="n">order_dir</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">hash_type</span> <span class="o">!=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="nb">hash</span> <span class="o">!=</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="n">hash_type</span><span class="p">]</span> <span class="o">=</span> <span class="nb">hash</span>

        <span class="k">if</span> <span class="n">include_finished</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&#39;include_finished&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span><span class="s">&#39;push/get&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

        <span class="n">retval</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;count&#39;</span><span class="p">:</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;count&#39;</span><span class="p">],</span>
            <span class="s">&#39;subscriptions&#39;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">subscription</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;subscriptions&#39;</span><span class="p">]:</span>
            <span class="n">retval</span><span class="p">[</span><span class="s">&#39;subscriptions&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PushSubscription</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">subscription</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">retval</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="PushSubscription.list_by_stream_hash"><a class="viewcode-back" href="../index.html#datasift.PushSubscription.list_by_stream_hash">[docs]</a>    <span class="k">def</span> <span class="nf">list_by_stream_hash</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="nb">hash</span><span class="p">,</span> <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">per_page</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">order_by</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">order_dir</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a page of push subscriptions in the given user&#39;s account</span>
<span class="sd">        subscribed to the given stream hash, where each page contains up to</span>
<span class="sd">        per_page items. Results will be ordered according to the supplied</span>
<span class="sd">        ordering parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">__class__</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">per_page</span><span class="p">,</span> <span class="n">order_by</span><span class="p">,</span> <span class="n">order_dir</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&#39;hash&#39;</span><span class="p">,</span> <span class="nb">hash</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="PushSubscription.list_by_playback_id"><a class="viewcode-back" href="../index.html#datasift.PushSubscription.list_by_playback_id">[docs]</a>    <span class="k">def</span> <span class="nf">list_by_playback_id</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">playback_id</span><span class="p">,</span> <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">per_page</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">order_by</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">order_dir</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a page of push subscriptions in the given user&#39;s account</span>
<span class="sd">        subscribed to the given playback ID, where each page contains up to</span>
<span class="sd">        per_page items. Results will be ordered according to the supplied</span>
<span class="sd">        ordering parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">__class__</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">per_page</span><span class="p">,</span> <span class="n">order_by</span><span class="p">,</span> <span class="n">order_dir</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&#39;playback_id&#39;</span><span class="p">,</span> <span class="n">playback_id</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="PushSubscription.get_logs"><a class="viewcode-back" href="../index.html#datasift.PushSubscription.get_logs">[docs]</a>    <span class="k">def</span> <span class="nf">get_logs</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">per_page</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">order_by</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">order_dir</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="nb">id</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Page through recent push subscription log entries, specifying the sort</span>
<span class="sd">        order.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">page</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;The specified page number is invalid&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">per_page</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;The specified per_page value is invalid&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">order_by</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">order_by</span> <span class="o">=</span> <span class="n">PushSubscription</span><span class="o">.</span><span class="n">ORDERBY_REQUEST_TIME</span>
        <span class="k">if</span> <span class="n">order_dir</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">order_dir</span> <span class="o">=</span> <span class="n">PushSubscription</span><span class="o">.</span><span class="n">ORDERDIR_DESC</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;page&#39;</span><span class="p">:</span> <span class="n">page</span><span class="p">,</span>
            <span class="s">&#39;per_page&#39;</span><span class="p">:</span> <span class="n">per_page</span><span class="p">,</span>
            <span class="s">&#39;order_by&#39;</span><span class="p">:</span> <span class="n">order_by</span><span class="p">,</span>
            <span class="s">&#39;order_dir&#39;</span><span class="p">:</span> <span class="n">order_dir</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="nb">id</span> <span class="o">!=</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span>

        <span class="k">return</span> <span class="n">user</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span><span class="s">&#39;push/log&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise a new object from data in a dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PushDefinition</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populate this object from the data in a dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;No id found in subscription data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_id</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;No name found in subscription data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;created_at&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;No created_at found in subscription data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_created_at</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;created_at&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;status&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;No status found in subscription data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;hash_type&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;No hash_type found in subscription data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hash_type</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;hash_type&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;hash&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;No hash found in subscription data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;hash&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;last_request&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;No last_request found in subscription data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_request</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;last_request&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;last_success&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;No last_success found in subscription data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_success</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;last_success&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;output_type&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;No output_type found in subscription data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_type</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;output_type&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;output_params&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;No output_params found in subscription data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_output_params</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;output_params&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_parse_output_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recursive method to parse the output_params as received from the API</span>
<span class="sd">        into the flattened, dot-notation used by the client libraries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_output_params</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="s">&#39;</span><span class="si">%s%s</span><span class="s">.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
                    <span class="n">retval</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">retval</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">retval</span>

<div class="viewcode-block" id="PushSubscription.reload"><a class="viewcode-back" href="../index.html#datasift.PushSubscription.reload">[docs]</a>    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Re-fetch this subscription from the API.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span><span class="s">&#39;push/get&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_id</span><span class="p">()</span> <span class="p">}))</span>
</div>
<div class="viewcode-block" id="PushSubscription.get_id"><a class="viewcode-back" href="../index.html#datasift.PushSubscription.get_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the subscription ID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">;</span>
</div>
<div class="viewcode-block" id="PushSubscription.get_name"><a class="viewcode-back" href="../index.html#datasift.PushSubscription.get_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the subscription name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
</div>
<div class="viewcode-block" id="PushSubscription.set_output_param"><a class="viewcode-back" href="../index.html#datasift.PushSubscription.set_output_param">[docs]</a>    <span class="k">def</span> <span class="nf">set_output_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set an output parameter. Checks to see if the subscription has been</span>
<span class="sd">        deleted, and if not calls the base class to set the parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_deleted</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Cannot modify a deleted subscription&#39;</span><span class="p">)</span>
        <span class="n">PushDefinition</span><span class="o">.</span><span class="n">set_output_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PushSubscription.get_created_at"><a class="viewcode-back" href="../index.html#datasift.PushSubscription.get_created_at">[docs]</a>    <span class="k">def</span> <span class="nf">get_created_at</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the timestamp when this subscription was created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_created_at</span>
</div>
<div class="viewcode-block" id="PushSubscription.get_status"><a class="viewcode-back" href="../index.html#datasift.PushSubscription.get_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the current status of this subscription. Make sure you call reload</span>
<span class="sd">        to get the latest data for this subscription first.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span>
</div>
<div class="viewcode-block" id="PushSubscription.is_deleted"><a class="viewcode-back" href="../index.html#datasift.PushSubscription.is_deleted">[docs]</a>    <span class="k">def</span> <span class="nf">is_deleted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True if this subscription has been deleted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">STATUS_DELETED</span>
</div>
<div class="viewcode-block" id="PushSubscription.get_hash_type"><a class="viewcode-back" href="../index.html#datasift.PushSubscription.get_hash_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_hash_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the hash type to which this subscription is subscribed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_type</span>
</div>
<div class="viewcode-block" id="PushSubscription.get_hash"><a class="viewcode-back" href="../index.html#datasift.PushSubscription.get_hash">[docs]</a>    <span class="k">def</span> <span class="nf">get_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the hash or playback ID to which this subscription is subscribed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span>
</div>
<div class="viewcode-block" id="PushSubscription.get_last_request"><a class="viewcode-back" href="../index.html#datasift.PushSubscription.get_last_request">[docs]</a>    <span class="k">def</span> <span class="nf">get_last_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the timestamp of the last push request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_request</span>
</div>
<div class="viewcode-block" id="PushSubscription.get_last_success"><a class="viewcode-back" href="../index.html#datasift.PushSubscription.get_last_success">[docs]</a>    <span class="k">def</span> <span class="nf">get_last_success</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the timestamp of the last successful push request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_success</span>
</div>
<div class="viewcode-block" id="PushSubscription.save"><a class="viewcode-back" href="../index.html#datasift.PushSubscription.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save changes to the name and output parameters of this subscription.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_id</span><span class="p">(),</span>
            <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output_params</span><span class="p">():</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT_PARAMS_PREFIX</span><span class="p">,</span> <span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output_param</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span><span class="s">&#39;push/update&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="PushSubscription.pause"><a class="viewcode-back" href="../index.html#datasift.PushSubscription.pause">[docs]</a>    <span class="k">def</span> <span class="nf">pause</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pause this subscription.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span><span class="s">&#39;push/pause&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_id</span><span class="p">()</span> <span class="p">}))</span>
</div>
<div class="viewcode-block" id="PushSubscription.resume"><a class="viewcode-back" href="../index.html#datasift.PushSubscription.resume">[docs]</a>    <span class="k">def</span> <span class="nf">resume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resume this subscription.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span><span class="s">&#39;push/resume&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_id</span><span class="p">()</span> <span class="p">}))</span>
</div>
<div class="viewcode-block" id="PushSubscription.stop"><a class="viewcode-back" href="../index.html#datasift.PushSubscription.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop this subscription.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span><span class="s">&#39;push/stop&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_id</span><span class="p">()</span> <span class="p">}))</span>
</div>
<div class="viewcode-block" id="PushSubscription.delete"><a class="viewcode-back" href="../index.html#datasift.PushSubscription.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete this subscription.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">call_api</span><span class="p">(</span><span class="s">&#39;push/delete&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_id</span><span class="p">()</span> <span class="p">})</span>
        <span class="c"># The delete API call doesn&#39;t return the object, so set the status</span>
        <span class="c"># manually</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">STATUS_DELETED</span>
</div>
<div class="viewcode-block" id="PushSubscription.get_log"><a class="viewcode-back" href="../index.html#datasift.PushSubscription.get_log">[docs]</a>    <span class="k">def</span> <span class="nf">get_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">per_page</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">order_by</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">order_dir</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a page of the log for this subscription in the order specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PushSubscription</span><span class="o">.</span><span class="n">get_logs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">per_page</span><span class="p">,</span> <span class="n">order_by</span><span class="p">,</span> <span class="n">order_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_id</span><span class="p">())</span>

<span class="c">#-----------------------------------------------------------------------------</span>
<span class="c"># The ApiClient class.</span>
<span class="c">#-----------------------------------------------------------------------------</span></div></div>
<div class="viewcode-block" id="ApiClient"><a class="viewcode-back" href="../index.html#datasift.ApiClient">[docs]</a><span class="k">class</span> <span class="nc">ApiClient</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The default class used for accessing the DataSift API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ApiClient.call"><a class="viewcode-back" href="../index.html#datasift.ApiClient.call">[docs]</a>    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">user_agent</span> <span class="o">=</span> <span class="n">USER_AGENT</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a call to a DataSift API endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">&#39;http://</span><span class="si">%s%s</span><span class="s">.json&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">API_BASE_URL</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;Auth&#39;</span><span class="p">:</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">api_key</span><span class="p">),</span>
            <span class="s">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="n">user_agent</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">params</span><span class="p">),</span> <span class="n">headers</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">except</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">URLError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="s">&#39;Request failed: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">err</span><span class="p">,</span> <span class="mi">503</span><span class="p">)</span>

        <span class="c"># Handle a response with no data</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="s">&#39;{}&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="s">&#39;Failed to decode the response&#39;</span><span class="p">,</span> <span class="n">retval</span><span class="p">[</span><span class="s">&#39;response_code&#39;</span><span class="p">])</span>

        <span class="n">retval</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;response_code&#39;</span><span class="p">:</span> <span class="n">resp</span><span class="o">.</span><span class="n">getcode</span><span class="p">(),</span>
            <span class="s">&#39;data&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
            <span class="s">&#39;rate_limit&#39;</span><span class="p">:</span> <span class="n">resp</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="s">&#39;x-ratelimit-limit&#39;</span><span class="p">),</span>
            <span class="s">&#39;rate_limit_remaining&#39;</span><span class="p">:</span> <span class="n">resp</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="s">&#39;x-ratelimit-remaining&#39;</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">retval</span>

<span class="c">#-----------------------------------------------------------------------------</span>
<span class="c"># The StreamConsumerEventHandler base class.</span>
<span class="c">#-----------------------------------------------------------------------------</span></div></div>
<div class="viewcode-block" id="StreamConsumerEventHandler"><a class="viewcode-back" href="../index.html#datasift.StreamConsumerEventHandler">[docs]</a><span class="k">class</span> <span class="nc">StreamConsumerEventHandler</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A base class for implementing event handlers for StreamConsumers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">on_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">consumer</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">on_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">consumer</span><span class="p">,</span> <span class="n">header</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">on_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">consumer</span><span class="p">,</span> <span class="n">interaction</span><span class="p">,</span> <span class="nb">hash</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">on_deleted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">consumer</span><span class="p">,</span> <span class="n">interaction</span><span class="p">,</span> <span class="nb">hash</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">on_warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">consumer</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">on_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">consumer</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">on_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">consumer</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">on_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">consumer</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="c">#-----------------------------------------------------------------------------</span>
<span class="c"># The StreamConsumer class. This class should never be used directly, but all</span>
<span class="c"># protocol-specific StreamConsumers should inherit from it.</span>
<span class="c">#-----------------------------------------------------------------------------</span></div>
<div class="viewcode-block" id="StreamConsumer"><a class="viewcode-back" href="../index.html#datasift.StreamConsumer">[docs]</a><span class="k">class</span> <span class="nc">StreamConsumer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the base class for all protocol-specific StreamConsumer classes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="StreamConsumer.factory"><a class="viewcode-back" href="../index.html#datasift.StreamConsumer.factory">[docs]</a>    <span class="k">def</span> <span class="nf">factory</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">consumer_type</span><span class="p">,</span> <span class="n">definition</span><span class="p">,</span> <span class="n">event_handler</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Factory method for creating protocol-specific StreamConsumer objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">consumer_module</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="s">&#39;streamconsumer_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">consumer_type</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">consumer_module</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">definition</span><span class="p">,</span> <span class="n">event_handler</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Consumer type &quot;</span><span class="si">%s</span><span class="s">&quot; is unknown&#39;</span> <span class="o">%</span> <span class="n">consumer_type</span><span class="p">)</span>
</div>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Consumer type definitions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">TYPE_HTTP</span> <span class="o">=</span> <span class="s">&#39;http&#39;</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Possible states.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">STATE_STOPPED</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">STATE_STARTING</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">STATE_RUNNING</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">STATE_STOPPING</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class variables</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_user</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_hashes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_event_handler</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_state</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_auto_reconnect</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">definition</span><span class="p">,</span> <span class="n">event_handler</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise a StreamConsumer object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">User</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Please supply a valid User object when creating a StreamConsumer object&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="n">user</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">definition</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">StringTypes</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hashes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">create_definition</span><span class="p">(</span><span class="n">definition</span><span class="p">)</span><span class="o">.</span><span class="n">get_hash</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">definition</span><span class="p">,</span> <span class="n">Definition</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hashes</span> <span class="o">=</span> <span class="n">definition</span><span class="o">.</span><span class="n">get_hash</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">definition</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hashes</span> <span class="o">=</span> <span class="n">definition</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;The definition must be a CSDL string, an array of hashes or a Definition object.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hashes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;No valid hashes found when creating the consumer.&#39;</span><span class="p">);</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_event_handler</span> <span class="o">=</span> <span class="n">event_handler</span>

<div class="viewcode-block" id="StreamConsumer.consume"><a class="viewcode-back" href="../index.html#datasift.StreamConsumer.consume">[docs]</a>    <span class="k">def</span> <span class="nf">consume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auto_reconnect</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start consuming.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auto_reconnect</span> <span class="o">=</span> <span class="n">auto_reconnect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">STATE_STARTING</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_start</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="StreamConsumer.stop"><a class="viewcode-back" href="../index.html#datasift.StreamConsumer.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop the consumer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_running</span><span class="p">(</span><span class="bp">True</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">InvalidDataError</span><span class="p">(</span><span class="s">&#39;Consumer state must be RUNNING before it can be stopped&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">STATE_STOPPING</span>
</div>
    <span class="k">def</span> <span class="nf">_get_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the URL for the required stream.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">protocol</span> <span class="o">=</span> <span class="s">&#39;http&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">use_ssl</span><span class="p">():</span>
            <span class="n">protocol</span> <span class="o">=</span> <span class="s">&#39;https&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hashes</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">://</span><span class="si">%s</span><span class="s">multi?hashes=</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">protocol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">stream_base_url</span><span class="p">,</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hashes</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">://</span><span class="si">%s%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">protocol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">_stream_base_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hashes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_auth_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the authorisation HTTP header.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">get_username</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">get_api_key</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_get_user_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the user agent to send with the request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="o">.</span><span class="n">get_useragent</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_is_running</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allow_starting</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is the consumer running?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">allow_starting</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">STATE_STARTING</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">STATE_RUNNING</span>

    <span class="k">def</span> <span class="nf">_get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the consumer state.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span>

    <span class="k">def</span> <span class="nf">_on_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when the stream socket has connected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">STATE_RUNNING</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_event_handler</span><span class="o">.</span><span class="n">on_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">header</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when the stream socket has connected, header is a dictionary</span>
<span class="sd">        with the http headers of the stream&#39;s reponse.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_event_handler</span><span class="o">.</span><span class="n">on_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">header</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">json_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called for each complete chunk of JSON data is received.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_running</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_on_error</span><span class="p">(</span><span class="s">&#39;Failed to decode JSON: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">json_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;status&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="c"># Status notification</span>
                <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;failure&#39;</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;error&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_on_error</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;message&#39;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;warning&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_on_warning</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;message&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_on_status</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s">&#39;hash&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="c"># Muli-stream data</span>
                <span class="k">if</span> <span class="s">&#39;deleted&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;deleted&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_event_handler</span><span class="o">.</span><span class="n">on_deleted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;hash&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_event_handler</span><span class="o">.</span><span class="n">on_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;hash&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="s">&#39;interaction&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="c"># Single stream data</span>
                <span class="k">if</span> <span class="s">&#39;deleted&#39;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;deleted&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_event_handler</span><span class="o">.</span><span class="n">on_deleted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hashes</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_event_handler</span><span class="o">.</span><span class="n">on_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hashes</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Unknown message</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_on_error</span><span class="p">(</span><span class="s">&#39;Unhandled data received: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">json_data</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_on_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when an error occurs. Errors are considered unrecoverable so</span>
<span class="sd">        we stop the consumer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Stop the consumer if we get an error</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_running</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_event_handler</span><span class="o">.</span><span class="n">on_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when a warning is raised or received.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_event_handler</span><span class="o">.</span><span class="n">on_warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when a status message is raised or received.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_event_handler</span><span class="o">.</span><span class="n">on_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when the stream socket is disconnected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_event_handler</span><span class="o">.</span><span class="n">on_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">DataSift Python Client Library 0.5.5 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, DataSift.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>