<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>What’s New? &mdash; datasift 2.10.0 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.10.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="datasift 2.10.0 documentation" href="index.html" />
    <link rel="next" title="Asynchronous Mode" href="async.html" />
    <link rel="prev" title="Getting Started" href="gettingstarted.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="async.html" title="Asynchronous Mode"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="gettingstarted.html" title="Getting Started"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">datasift 2.10.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="what-s-new">
<span id="whatsnew"></span><h1>What&#8217;s New?<a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h1>
<div class="section" id="handling-api-errors">
<h2>Handling API Errors<a class="headerlink" href="#handling-api-errors" title="Permalink to this headline">¶</a></h2>
<p>In the 2.0 revamp of this library it now throws exceptions quite often. This is to help our end users deal with problems in an easier manner.</p>
<p>If you make an invalid request, for example compiling invalid CSDL, you&#8217;ll get an exception:</p>
<div class="highlight-python"><div class="highlight"><pre>&gt;&gt;&gt; client.compile(&quot;interaction.content contains&quot;)
Traceback (most recent call last):
File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
File &quot;/home/andi/workspace/datasift-python-dev/datasift/client.py&quot;, line 256, in compile
  return self.request.post(&#39;compile&#39;, data=dict(csdl=csdl))
File &quot;/home/andi/workspace/datasift-python-dev/datasift/request.py&quot;, line 37, in post
  return self.build_response(self(&#39;post&#39;, path, params=params, headers=headers, data=data), path=path)
File &quot;/home/andi/workspace/datasift-python-dev/datasift/request.py&quot;, line 78, in build_response
  raise DataSiftApiException(Response(response, data))
datasift.exceptions.DataSiftApiException: At line 1 position 29 we were expecting a text value
</pre></div>
</div>
<p>The API wasn&#8217;t happy with the request you sent it, so the client library has raised a DataSiftApiException, these are thrown whenever the server sends back an error, and are designed to help you cope with them easily.</p>
<p>You can deal with these like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">datasift.exceptions</span> <span class="kn">import</span> <span class="n">DataSiftApiException</span>

<span class="k">try</span><span class="p">:</span>
    <span class="nb">hash</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;interaction.content contains python&#39;</span><span class="p">)[</span><span class="s">&quot;hash&quot;</span><span class="p">]</span>
    <span class="k">print</span> <span class="nb">hash</span>
<span class="k">except</span> <span class="n">DataSiftApiException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;API error:&quot;</span><span class="p">,</span> <span class="n">e</span>
</pre></div>
</div>
<p>When running this, we&#8217;ll get the following output:</p>
<div class="highlight-python"><div class="highlight"><pre>API error: We are unable to parse this stream. At line 1 position 29 we were expecting a text value
</pre></div>
</div>
<p>This lets us catch the exception before it tries to use the hash for anything, or before it works out that the response had no hash in it.</p>
<p>Since the exception is a <tt class="xref py py-class docutils literal"><span class="pre">DataSiftApiException</span></tt>, we&#8217;ve got some extra features in it to help you out. If you want more information about why the exception was thrown you can pull the raw interaction out of the exception to look at it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">e</span><span class="o">.</span><span class="n">response</span>
<span class="go">{u&#39;error&#39;: u&#39;We are unable to parse this stream. At line 1 position 29 we were expecting a text value&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span>
<span class="go">400</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span>
<span class="go">{&#39;x-api-version&#39;: &#39;1.1&#39;, &#39;x-ratelimit-remaining&#39;: &#39;9930&#39;, &#39;transfer-encoding&#39;: &#39;chunked&#39;, &#39;server&#39;: &#39;nginx/0.8.55&#39;, &#39;connection&#39;: &#39;close&#39;, &#39;x-ratelimit-limit&#39;: &#39;10000&#39;, &#39;x-ratelimit-cost&#39;: &#39;5&#39;, &#39;date&#39;: &#39;Wed, 29 Jan 2014 16:53:03 GMT&#39;, &#39;p3p&#39;: &#39;CP=&quot;CAO PSA&quot;&#39;, &#39;content-type&#39;: &#39;application/json&#39;}</span>
</pre></div>
</div>
</div>
<div class="section" id="live-stream-consumption">
<h2>Live Stream Consumption<a class="headerlink" href="#live-stream-consumption" title="Permalink to this headline">¶</a></h2>
<p>Also new to this version of the library is the overhauled live stream consumption mode. This uses the autobahn websocket library to stream interactions live from the DataSift API and allows you to work with it by registering callbacks.</p>
<p>The simple example for live streaming looks like this</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">datasift</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="s">&quot;yourusername&quot;</span><span class="p">,</span> <span class="s">&quot;your API key&quot;</span><span class="p">)</span>

<span class="nd">@client.on_delete</span>
<span class="k">def</span> <span class="nf">on_delete</span><span class="p">(</span><span class="n">interaction</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Delete interaction: &quot;</span><span class="p">,</span> <span class="n">interaction</span>

<span class="nd">@client.on_open</span>
<span class="k">def</span> <span class="nf">on_open</span><span class="p">():</span>
    <span class="k">print</span> <span class="s">&quot;Stream client set up, subscribing to stream&quot;</span>
    <span class="n">csdl</span> <span class="o">=</span> <span class="s">&#39;interaction.content contains &quot;DataSift&quot;&#39;</span>
    <span class="n">stream</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">csdl</span><span class="p">)[</span><span class="s">&#39;hash&#39;</span><span class="p">]</span>

    <span class="nd">@client.subscribe</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">on_interaction</span><span class="p">(</span><span class="n">interaction</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;Recieved interaction: &quot;</span><span class="p">,</span> <span class="n">interaction</span>

<span class="nd">@client.on_closed</span>
<span class="k">def</span> <span class="nf">on_close</span><span class="p">(</span><span class="n">wasClean</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">reason</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Stream subscriber shutting down because &quot;</span><span class="p">,</span> <span class="n">reason</span>

<span class="c">#must start stream subscriber</span>
<span class="n">client</span><span class="o">.</span><span class="n">start_stream_subscriber</span><span class="p">()</span>
</pre></div>
</div>
<p>As you can see this new interface uses python decorators to register callbacks for events during the subscription.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">What&#8217;s New?</a><ul>
<li><a class="reference internal" href="#handling-api-errors">Handling API Errors</a></li>
<li><a class="reference internal" href="#live-stream-consumption">Live Stream Consumption</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="gettingstarted.html"
                        title="previous chapter">Getting Started</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="async.html"
                        title="next chapter">Asynchronous Mode</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/whatsnew.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="async.html" title="Asynchronous Mode"
             >next</a> |</li>
        <li class="right" >
          <a href="gettingstarted.html" title="Getting Started"
             >previous</a> |</li>
        <li><a href="index.html">datasift 2.10.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, MediaSift Ltd..
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>